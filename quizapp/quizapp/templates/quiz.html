{% extends "base_of_game_and_result.html" %}
<!DOCTYPE html>
<html lang="en">
<head>
	{% block title %}Match vs. Someone{% endblock %}
	{% block head %}
	{{ super() }}
	{% endblock %}
</head>

<body>
	{% block left %}
	{{ super() }}
	{% endblock %}
	
	{% block middle %}
	<div class="col-md-8 main-inner">
		<div class="panel panel-default" style="text-align:center">
			<div class="progress">
				<div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
					<span class="sr-only">60% Complete</span>
				</div>
			</div>
			<h1>{{ question }}</h1>
			<br>
			<div style="height:200px; background:grey">
				<h1>Picture</h1>
			</div>
			
			<div class="well well-menu">
				<button type="button" id="button1" class="btn btn-default btn-inner">{{ answer1 }}</button>
				<button type="button" id="button2" class="btn btn-default btn-inner">{{ answer2 }}</button>
				<br>
				<button type="button" id="button3" class="btn btn-default btn-inner">{{ answer3 }}</button>
				<button type="button" id="button4" class="btn btn-default btn-inner">{{ answer4 }}</button>
			</div>
		</div>
		<div>{{ quiz_key }}</div>
	</div>
	{% endblock %}

	{% block right %}
	{{ super() }}
	{% endblock %}
	
	{% block script %}
	{{ super() }}
	<script type="text/javascript" src="/_ah/channel/jsapi"></script>
	<script type="text/javascript">		
		var state = {
			user : "{{ user }}",
			quiz_key : "{{ quiz_key }}"
		};			
		var	sendMessage = function(path) {
			var xhr = new XMLHttpRequest();
			xhr.open('POST', path, true);
			xhr.send();
		};		
		var	submit = function(button) {
			var source = document.getElementById(button);
			var answer = source.innerHTML;
			var parameters = '?user=' + state.user + '&quiz_key=' + state.quiz_key + '&answer=' + answer + '&score=' + 100;
			sendMessage('/quiz/submit' + parameters);
		};									
		var	onMessage = function(m) {
			updateGame();
		};					
		var	openChannel = function() {
			var token = '{{ token }}';
			var channel = new goog.appengine.Channel(token);
			var handler = {
				'onopen': function() {},
				'onmessage': onMessage,
				'onerror': function() {},
				'onclose': function() {}
			};
			var socket = channel.open(handler);
			socket.onopen = onOpen;
			socket.onmessage = onMessage;
		};
		
		$('#button1').click(function(){ submit("button1"); });
		$('#button2').click(function(){ submit("button2"); });
		$('#button3').click(function(){ submit("button3"); });
		$('#button4').click(function(){ submit("button4"); });
		
		$(function(){ openChannel(); });
	</script>
	{% endblock %}
</body>
</html>